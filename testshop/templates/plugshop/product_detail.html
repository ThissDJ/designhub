{% extends 'plugshop/base.html' %}
{% load plugshop  mptt_tags filename setting %}
{% block title %}{{object}},by {{object.designer}} | Design Hub{% endblock %}
{% block extrahead %}
<meta name="description" content="{{object.description}}" />
<meta name="keywords" content="{{object.category}},{{object}},{{object.designer}},Design Hub" />
{% endblock %}
{% block extrastyle %}
<link rel="stylesheet" href="{{ MEDIA_URL }}js/cloud-zoom.1.0.2/cloud-zoom.css">
{% endblock %}
{% block shop-content %}
<div class="container"style="margin-top:10px;margin-bottom:20px;padding-top:10px;padding-bottom:20px;">
    	<div style="width:630px;float:left;">
	    	<div id="product">
	    		<div class="slides_container">
	    			{% for i in product.images.all %}
	    			<a class="clickNext" href="javascript:void(0);"  target="_blank"><img src='{{MEDIA_URL}}{% setting UPLOAD_URI %}{{ i.fpath.name|filename:".630x630"}}' alt=""></a>
	    			{% endfor %}
	    		</div>
	    		<ul class="pagination">
	            	{% for i in product.images.all %}
	            	    <li><a href="#" class="product-detail-thumnail"><img src='{{MEDIA_URL}}{% setting UPLOAD_URI %}{{ i.fpath.name|filename:".100x100"}}' width="100" alt=""></a></li>
	            	{% endfor %}
	    		</ul>
	    	</div>
	    	<div class="clearfix"></div>
	    	<div>
	    	    <br><br>
	    	    <!-- AddThis Button BEGIN -->
<!--				<a class="addthis_button" href="http://www.addthis.com/bookmark.php?v=250&amp;pubid=ra-502f056f32162b33"><img src="http://s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>
				<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
				<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-502f056f32162b33"></script>-->
<div class="addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<a class="addthis_button_pinterest_share"></a>
<a class="addthis_button_sinaweibo"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-502f056f32162b33"></script>

				<!-- AddThis Button END -->
                <br><br><!--<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fwww.designhub.hk{{request.path}}&layout=button_count&amp;show_faces=true&amp; width=450&amp;action=like&amp;colorscheme=light&amp;height=20" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:80px; height:20px;" allowtransparency="true"></iframe>-->
            </div>
    	</div>
    	<div style="width:500px;float:right;">
    			<h1>{{object}}</h1>
				      {% if user.is_active and user.is_staff %}
		              <a href="{% url update-product-form product.category.get_path product.slug %}" style="font-size:20px;">Modify This Product</a>
		              {% endif %}
                <br><br>
    			<h2>{{object.price}} <small> HKD</small> {% if object.original_price %} <small style="text-decoration: line-through;">Retail price:{{object.original_price}} HKD</small>{%endif%}</h2>
                <br>
                {% if object.time_discount and object.restTime %}
                <h2>Sale ends in {{object.restTime}}</h2>
                {% endif %}
    		    {% autoescape off %}
    		    {{object.idea}}
    		    {% endautoescape %}
    		    <br><br>
    			<h2>Product Description</h2>
    		    {% autoescape off %}
    		    {{object.description}}
				{% endautoescape %}
                <br><br>
    			{% if object.checkStorage %}
    			    <form class="well form-inline ajax-form" action="{% url plugshop-cart %}" method="post">{% csrf_token %}
                            <input type="hidden" name="product" value="{{object.id}}">
                            <input type="hidden" name="_action" value="add">
		    			    {% if object.checkStorage.0.size %}
	    			        	<label class="control-label" for="size" >Size:</label>
	    			        	<div class="controls"  style="display:inline-block;">
	    			        		<select id="size" class="span1" name="size">
				    			        {% for storage in object.checkStorage %}
							                <option>{{storage.size}}</option>
				                        {% endfor %}
	                                </select>
	                            </div>
	                            <label class="control-label" for="quantity" style="margin-left:2em;">Quantity:</label>
	                        {% else %}
	                            <label class="control-label" for="quantity">Quantity:</label>
	                        {% endif %}
	    			        	<div class="controls"  style="display:inline-block;">
	    			        		<select id="num" class="span1" name="quantity">
							            <option>1</option>
							            <option>2</option>
							            <option>3</option>
							            <option>4</option>
							            <option>5</option>
	                                </select>
	                           </div>
		    			 <button id="buy" type="submit" class="btn btn-primary btn-danger" style="float:right;">Add to cart</button>
    			    </form>
    			{% else %}
    			    <p>Soldout</p>
    			{% endif %}
    			<br>
    		{% if object.delivery %}
	    		    <h2>Delivery Info.</h2>
	    		    {% autoescape off %}
	    		    {{object.delivery}}
					{% endautoescape %}	
					<br><br>
    		{% endif %}
    </div>
    <div class="clearfix" ></div>
    <div style="margin-top:20px;">
    	<div style="float:left;width:20%;" >
			<a href="{% url designer-detail product.designer.slug %}" class="hover-dec-opacity">
				    <img src="{{MEDIA_URL}}{% setting UPLOAD_URI %}{{ product.designer.avatar.name|filename:".200x200"}}">			
			</a>
    	</div>
		<div  style="float:right;width:80%" >
			<h3>{{object.designer}}</h3>
		    {% autoescape off %}
			{{object.designer.description}}
			{% endautoescape %}
			<h3 style="margin-top:30px;">Say Something to The Designer</h3>
			<div id="comment_container_container">
				<div class="comment_container row-fluid"><p class="no-any-comment">No any yet, will you become the first one?</p></div>
				<div class="row-fluid">
					{% if  user.is_authenticated %}
				  	     <textarea class="post-comment-textarea"></textarea><a href="#" class="btn post-comment-btn">Post</a>
				  	{% else %}
				  	     <a href="/accounts/login/?next={{request.path}}" class="btn">Login to Post</a>
				  	{% endif %}
				</div>
			</div>
		</div>
    </div>
</div>

<script type="text/template" id="ProductTemplate">
</script>
<script type="text/template" id="CommentTemplate">
	<div>
<h5><%= user.username %> : <small><%= content %></small></h5> <div style="color:#bbb;text-align:right;"> <%= new Date(created).toString().substring(0,16) %></div></div>	
</script>
<script type="text/template" id="HideCommentTemplate">
	<div class="hide hide-comment">
<h5 ><%= user.username %> : <small><%= content %></small></h5>	<div style="color:#bbb;text-align:right;"> <%= new Date(created).toString().substring(0,16) %></div></div>
</script>
<script type="text/template" id="MoreCommentTemplate">
<p><button class='btn more-comments not-clicked-yet' href='#'>More comments</button></p>	
</script>
<div class="push"></div>
{% endblock shop-content %}
{% block extrajs %}
<script type="text/javascript" src="{{MEDIA_URL}}js/slides.min.jquery.js"></script>
<script type="text/javascript">
var productid = {{object.id}};
</script>
<script src="{{MEDIA_URL}}js/libs/underscore-min.js"></script>
<script src="{{MEDIA_URL}}js/libs/backbone-min.js"></script>
<script src="{{MEDIA_URL}}js/libs/bootstrap-button.js"></script>
<script src="{{MEDIA_URL}}js/libs/utils.js"></script>
<script src="{{MEDIA_URL}}js/libs/jquery.cookie.js"></script>
<script src="{{MEDIA_URL}}js/libs/jquery.autocsrftoken.js"></script>
<!-- backbone application -->
<script src="{{MEDIA_URL}}js/product/models.js"></script>
<script src="{{MEDIA_URL}}js/product/views.js"></script>
<script src="{{MEDIA_URL}}js/product/controllers.js"></script>
<script type="text/javascript">
//alert(filenameWithSize('aadf.jpg','100x100'));
(function ($) {
    new AppRouter();
    Backbone.emulateHTTP = true;
    Backbone.emulateJSON = true;
    Backbone.history.start();
    
    
	$('#product').slides({
		preload: true,
		preloadImage: '{{ MEDIA_URL }}img/loading.gif',
		effect: 'slide, fade',
		crossfade: true,
		slideSpeed: 350,
		fadeSpeed: 500,
		generateNextPrev: true,
		generatePagination: false
	});
	$("#product a.clickNext").live('click',function(){
		$("#product a.next").click();
		return false;
	});

	var form = $('.ajax-form');

	form.submit( function() {
		$.ajax( {
		  type: "POST",
		  url: form.attr( 'action' ),
		      data: form.serialize(),
		      success: function( response ) {
		      	if(response.canBuy === 'yes'){
		      		window.location = response.redirectUrl
		      	}else{
		      		alert('Sorry, the product ' + response.productName +' has just ' + response.storage + ' pieces, \n' + 'plz change the quantity to buy.')
		      	}
		        return false;
		      }
		    } );
		return false;
	} );
})(jQuery);

</script>
{% endblock %}
