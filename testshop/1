from django.conf.urls import patterns, include, url
from django.conf import settings
from testshop.shop.views import ProductListViewHome, DesignerListView,DesignerDetailView
from testshop.shop.models import Product, Designer,DesignerCreateForm

from testshop.utils.views import DesignerCreateView,DesignerUpdateView,DesignerDeleteView, ProductUpdateView
from django.contrib.auth.decorators import login_required,permission_required
from django.contrib import admin
from django.core.urlresolvers import reverse

admin.autodiscover()

urlpatterns = patterns('testshop.shop.views',
    url(r"^$", ProductListViewHome.as_view(), 
            name='plugshop-product-list-home'),
    url(r"^designers", DesignerListView.as_view(), 
            name='plugshop-designer-list'),
    url(r"^designer/(?P<slug>[\-\/\w]+)/$", DesignerDetailView.as_view(),name="designer-detail"),
)

urlpatterns += patterns('',
    url(r'^paypal/$','testshop.shop.views.paypal', name='paypal'),
)
urlpatterns += patterns('',
    url(r'^ipn-location/', include('paypal.standard.ipn.urls')),
)
urlpatterns += patterns('',
    url(r'^ipn-return/', 'testshop.shop.views.ipnreturn',name='paypal-myreturn'),
    url(r'^ipn-cancel/', 'testshop.shop.views.ipncancel',name='paypal-mycancel'),
)
urlpatterns += patterns('',
    (r'^paypal/pdt/', include('paypal.standard.pdt.urls')),
)
urlpatterns += patterns('',
    url(r'^contact-info/','testshop.shop.views.collectContactInfo'),
)

urlpatterns += patterns('',
    url(r'^accounts/',include('testshop.registration.urls')),
)
urlpatterns += patterns('',
    url(r'^admin-designer/add/', permission_required('shop.add_designer')(DesignerCreateView.as_view(
                   )), name='fireflie-create-designer-form'),
    url(r'^admin-designer/update/(?P<slug>[\-\/\w]+)/$', permission_required('shop.change_designer')(DesignerUpdateView.as_view(
                   model=Designer,
                   )), name='fireflie-update-designer-form'),
    url(r'^admin-designer/delete/(?P<slug>[\-\/\w]+)/$', permission_required('shop.delete_designer')(DesignerDeleteView.as_view(
                   )), name='fireflie-delete-designer-form'),
)
urlpatterns += patterns('',\
    url(r"^admin-product/update/(?P<category_path>[\-\/\w]+)/(?P<slug>[\-\/\w]+)$", 
        permission_required('shop.change_product')(ProductUpdateView.as_view(
                   model=Product,
                   )), name='update-product-form'),
)

urlpatterns += patterns('',
    url(r'^admin/', include(admin.site.urls)),
    url(r'^shop/', include('testshop.shop.urls')),
#    url(r'^shop/', include('plugshop.urls')),
)

if settings.DEBUG:
    urlpatterns += patterns('',
        (r'^media/(?P<path>.*)$', 'django.views.static.serve', {'document_root': settings.MEDIA_ROOT}),
    )
